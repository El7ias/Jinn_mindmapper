# âš¡ MindMapper

> A node-based mind mapping tool with circuit board aesthetics â€” now with AI-powered agent orchestration. Connect your ideas like a circuit board, then generate autonomous build prompts for a virtual development team.

![Phase](https://img.shields.io/badge/Phase-3%20In_Progress-00e5ff?style=flat-square)
![Stack](https://img.shields.io/badge/Stack-Vite%20+%20Vanilla%20JS-ffc107?style=flat-square)
![Persistence](https://img.shields.io/badge/Storage-localStorage%20+%20Firebase-00ff88?style=flat-square)
![AI](https://img.shields.io/badge/AI-Multi--Provider%20LLM-ff2d78?style=flat-square)
![Security](https://img.shields.io/badge/Security-CSP%20+%20DOMPurify-7c4dff?style=flat-square)

## Features

### Core Canvas

- ğŸ§© **Infinite canvas** â€” pan (Space+drag), zoom (scroll wheel), PCB grid background
- ğŸ“¦ **Node system** â€” create, edit, move, select, multi-select, color-code, delete
- ğŸ”Œ **Circuit trace connections** â€” orthogonal SVG paths with glow effects and solder-point endpoints

### Smart Wiring

- ğŸ¯ **Drag to port** â€” precise port-to-port connections
- ğŸ§² **Drop on node body** â€” auto-detects the nearest port
- âœ¨ **Drag to empty space** â€” auto-creates a new node and connects it
- ğŸ”§ **Drag solder dots** â€” detach or rewire connections by dragging endpoints
- ğŸ”€ **Splice node into wire** â€” drag a node onto a wire to insert it into the flow

### Wire Rendering

- â¤µï¸ **Arrowheads** â€” right-click any wire for one-way or bidirectional arrows
- â‡† **Bidirectional** â€” arrows at both ends for two-way flows
- ğŸ”„ **Reverse direction** â€” swap flow direction with one click
- â¤» **Wire jump arcs** â€” PCB-style semicircle arcs where wires cross
- ğŸ’¾ **Persisted** â€” arrow state and shapes survive page reloads

### Node Shapes

- â–¬ **Rectangle** â€” Process / Task (default)
- â–¢ **Rounded** â€” Start / End
- â—‡ **Diamond** â€” Decision
- â–± **Parallelogram** â€” Input / Output
- â¬¡ **Hexagon** â€” Preparation
- â— **Circle** â€” Event / Trigger
- â–­ **Pill** â€” Terminal

### ğŸ¤– AI-Powered Idea Generation (Phase 3)

- ğŸ’¡ **Idea-to-Mind Map** â€” type a concept, get a full mind map generated by AI
- ğŸ”Œ **Multi-provider support** â€” Google (Gemini), OpenAI (GPT), Anthropic (Claude)
- ğŸ¯ **Smart defaults** â€” efficient models selected automatically; premium models available as upgrades
- ğŸ§  **Structured output** â€” AI generates nodes with types, priorities, and connections

### ğŸ¯ Agent Orchestration Pipeline (Phase 3)

- ğŸ“‹ **Mind Map Serializer** â€” extracts features, constraints, risks, tech notes, references, and dependencies from any mind map
- ğŸ—ï¸ **Workflow Prompt Generator** â€” transforms serialized data into a complete Claude Code orchestration prompt
- ğŸ‘¥ **10-Role Virtual Team** â€” generated prompts define a full agent team:
  - ğŸ‘” **Orchestrator (COO)** â€” executive function, task sequencing, milestone tracking
  - ğŸ—ï¸ **CTO** â€” architecture decisions, framework selection, design approval
  - ğŸ¨ **Creative Director** â€” visual identity, design system, branding, accessibility
  - ğŸ–¥ï¸ **Front-End Agent** â€” UI implementation, user journeys, responsive layout
  - âš™ï¸ **Backend Agent** â€” APIs, data models, security rules, deployment
  - ğŸ›¡ï¸ **Sentinel** â€” dedicated security specialist, OWASP, threat modeling
  - ğŸ“ **Research Agent** â€” tech investigation, trade-off analysis, tech journal
  - ğŸ“ **Documenter** â€” README, API docs, changelogs, migration guides
  - ğŸ˜ˆ **Devil's Advocate** â€” QA challenger, architecture stress-testing
  - ğŸ”¢ **Auditors** â€” token tracking, API cost monitoring, project health
- ğŸ“Š **Prompt Export Modal** â€” preview, copy, or download the generated prompt as JSON or Markdown
- ğŸ§  **Intelligent Routing** â€” generated prompts include model routing metadata that the executing agent uses to optimize task-level processing efficiency

### Node Metadata (Phase 3)

- ğŸ·ï¸ **Node types** â€” feature, constraint, risk, question, milestone, dependency, note, general
- ğŸ“Š **Priority levels** â€” critical, high, medium, low
- ğŸ¤– **Agent assignment** â€” assign nodes to virtual agent roles
- ğŸ“ˆ **Agent status** â€” pending, in-progress, review, complete, blocked, deferred
- ğŸ¯ **Visual overlays** â€” status badges, priority rings, agent chips, meta text

### Context Menus

- **Canvas**: Add Node, Zoom to Fit, Reset Zoom
- **Node**: Edit Text, Shape Picker (7 shapes), Node Type, Priority, Agent Assignment, Duplicate, Disconnect All, Delete
- **Connection**: Add/Remove Arrow, Bidirectional, Reverse Direction, Delete

### Quality of Life

- â†©ï¸ **Undo/Redo** â€” Ctrl+Z / Ctrl+Y with deep state snapshots
- ğŸ’¾ **Auto-save** â€” debounced localStorage persistence
- ğŸ—ºï¸ **Minimap** â€” overview with click-to-navigate
- ğŸ“‹ **Property panel** â€” edit node label, color, view metadata

### ğŸ“ File Management

- ğŸ“¢ **File menu dropdown** â€” New, Open, Save, Save As, Export, Import
- ğŸ“„ **New Project** â€” clear canvas with discard confirmation
- ğŸ“‚ **Open File** â€” load `.mindmap` or `.json` project files
- ğŸ’¾ **Save / Save As** â€” download as `.mindmap` JSON file
- ğŸ–¼ï¸ **Export PNG** â€” canvas-rendered image with nodes, connections, and jump arcs
- { } **Export JSON** â€” pretty-printed JSON with metadata
- â—‡ **Export SVG** â€” scalable vector graphic output
- ğŸ“ **Import Reference** â€” auto-convert `.md`, `.txt`, images, `.doc` into mind maps
- ğŸ·ï¸ **Project title** â€” shown in toolbar, updates on save/open

### ğŸ¨ Project Templates

- ğŸ“± **6 built-in presets** â€” iOS App, Android App, Local Executable, SaaS Platform, Website Wireframe, Website Map
- ğŸ“€ **Custom templates** â€” save current canvas as a reusable preset
- ğŸ¯ **Category filters** â€” All, Mobile, Desktop, Web, SaaS, Custom
- ğŸ“Š **Mini previews** â€” SVG thumbnail for each preset

### ğŸ”’ Security

- ğŸ›¡ï¸ **Content Security Policy** â€” CSP meta tag blocks inline scripts, restricts API connections, prevents plugin injection
- ğŸ§¹ **HTML Sanitization** â€” all user text and AI-generated markdown sanitized via DOMPurify before DOM injection
- ğŸ”‘ **API Key Protection** â€” keys sent via request headers (not URL params); CSP mitigates XSS-based key theft
- ğŸ“¦ **Shared Sanitize Utility** â€” `escapeHtml()`, `sanitizeHtml()`, `escapeAttr()` for all components

## Quick Start

```bash
# Install dependencies
npm install

# Start dev server
npm run dev
```

Open **http://localhost:5173** in your browser.

## Keyboard Shortcuts

| Shortcut              | Action             |
| --------------------- | ------------------ |
| `Double-click canvas` | Create new node    |
| `Double-click node`   | Edit node text     |
| `Double-click wire`   | Delete connection  |
| `Delete`              | Delete selected    |
| `Escape`              | Deselect all       |
| `Ctrl+Z`              | Undo               |
| `Ctrl+Y`              | Redo               |
| `Ctrl+S`              | Auto-save          |
| `Ctrl+N`              | New Project        |
| `Ctrl+O`              | Open File          |
| `Ctrl+Shift+S`        | Save As            |
| `Space + drag`        | Pan canvas         |
| `Scroll wheel`        | Zoom in/out        |
| `Shift + click`       | Multi-select nodes |
| `Right-click`         | Context menu       |

## Tech Stack

| Layer       | Technology                                  |
| ----------- | ------------------------------------------- |
| Bundler     | Vite 6.x                                    |
| Language    | Vanilla ES6+ JavaScript                     |
| Rendering   | DOM (nodes) + SVG (connections)             |
| Styling     | Vanilla CSS + Custom Properties             |
| Fonts       | JetBrains Mono + Inter                      |
| Persistence | localStorage + Firebase (Phase 3)           |
| AI          | Google Gemini, OpenAI GPT, Anthropic Claude |
| Security    | CSP + DOMPurify + shared Sanitize utility   |

## Project Structure

```
mindmapper/
â”œâ”€â”€ index.html                           # App shell + SVG defs + modals
â”œâ”€â”€ Orchistrator.md                      # Reference: original orchestration prompt
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.js                          # Entry point + keyboard shortcuts
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ EventBus.js                  # Pub/sub messaging
â”‚   â”‚   â”œâ”€â”€ History.js                   # Undo/redo stack
â”‚   â”‚   â””â”€â”€ Sanitize.js                  # HTML sanitization (escapeHtml, sanitizeHtml, escapeAttr)
â”‚   â”œâ”€â”€ viewport/
â”‚   â”‚   â””â”€â”€ Viewport.js                  # Pan, zoom, coordinates
â”‚   â”œâ”€â”€ nodes/
â”‚   â”‚   â””â”€â”€ NodeManager.js               # Node CRUD + drag + metadata + agent roles
â”‚   â”œâ”€â”€ connections/
â”‚   â”‚   â””â”€â”€ ConnectionManager.js         # Wiring, routing, arrows, jump arcs
â”‚   â”œâ”€â”€ ai/
â”‚   â”‚   â”œâ”€â”€ IdeaGenerator.js             # Multi-provider LLM idea generation
â”‚   â”‚   â””â”€â”€ ModelTierConfig.js           # Tiered model routing strategy
â”‚   â”œâ”€â”€ export/
â”‚   â”‚   â”œâ”€â”€ MindMapSerializer.js         # Canvas â†’ structured data extraction
â”‚   â”‚   â””â”€â”€ WorkflowPromptGenerator.js   # Structured data â†’ Claude Code prompt
â”‚   â”œâ”€â”€ validation/
â”‚   â”‚   â””â”€â”€ MindMapValidator.js          # Mind map readiness validation
â”‚   â”œâ”€â”€ firebase/
â”‚   â”‚   â”œâ”€â”€ config.js                    # Firebase SDK initialization
â”‚   â”‚   â”œâ”€â”€ auth.js                      # Google Sign-In + session management
â”‚   â”‚   â”œâ”€â”€ firestore.js                 # Firestore CRUD operations
â”‚   â”‚   â”œâ”€â”€ listeners.js                 # Real-time onSnapshot listeners
â”‚   â”‚   â”œâ”€â”€ migration.js                 # localStorage â†’ Firestore migration
â”‚   â”‚   â””â”€â”€ gateway.js                   # LLM Gateway client adapter
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ ContextMenu.js               # Right-click menus (canvas/node/connection)
â”‚   â”‚   â”œâ”€â”€ PropertyPanel.js             # Node property editor
â”‚   â”‚   â”œâ”€â”€ MiniMap.js                   # Overview map
â”‚   â”‚   â”œâ”€â”€ FileMenu.js                  # File dropdown menu
â”‚   â”‚   â”œâ”€â”€ PresetModal.js               # Template picker modal
â”‚   â”‚   â”œâ”€â”€ AgentPanel.js                # Agent conversation sidebar
â”‚   â”‚   â”œâ”€â”€ IdeaInputModal.js            # AI idea generation modal
â”‚   â”‚   â””â”€â”€ PromptExportModal.js         # Workflow prompt preview + export
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ Storage.js                   # localStorage adapter
â”‚   â”‚   â””â”€â”€ FileManager.js              # File I/O: save/open/export/import
â”‚   â”œâ”€â”€ import/
â”‚   â”‚   â””â”€â”€ ReferenceImporter.js         # Reference file â†’ mind map converter
â”‚   â”œâ”€â”€ presets/
â”‚   â”‚   â”œâ”€â”€ PresetManager.js             # Built-in + custom presets
â”‚   â”‚   â””â”€â”€ builtinPresets.js            # 6 project templates
â”‚   â””â”€â”€ styles/
â”‚       â””â”€â”€ main.css                     # PCB design system
â””â”€â”€ docs/
    â”œâ”€â”€ architecture.md                  # System architecture
    â”œâ”€â”€ changelog.md                     # Feature changelog
    â”œâ”€â”€ implementation_plan.md           # Phase plan + verification
    â”œâ”€â”€ phase3_plan.md                   # Phase 3 detailed plan
    â””â”€â”€ tech-journal.md                  # Decision log
```

## Documentation

- **[Architecture](docs/architecture.md)** â€” System design, module diagram, data models, event bus, AI pipeline
- **[Changelog](docs/changelog.md)** â€” Detailed feature log with LOC breakdown
- **[Tech Journal](docs/tech-journal.md)** â€” Design decisions and trade-offs
- **[Implementation Plan](docs/implementation_plan.md)** â€” Phase status and verification steps
- **[Phase 3 Plan](docs/phase3_plan.md)** â€” Detailed agent orchestration plan

## Roadmap

- [x] **Phase 1** â€” Standalone client-side app with localStorage
- [x] **Phase 1.1** â€” Splice-on-wire, jump arcs, bidirectional arrows, node shapes
- [x] **Phase 2** â€” File management (New/Open/Save/Export/Import) + project template presets
- [ ] **Phase 3** â€” AI pipeline: idea generation, node metadata, agent orchestration, prompt export
  - [x] 3.0 â€” Firebase infrastructure foundation
  - [x] 3.2 â€” Node metadata system (types, priorities, agent roles)
  - [x] 3.3 â€” Agent panel (sidebar UI)
  - [x] 3.4 â€” AI idea generation (multi-provider LLM)
  - [x] 3.5 â€” Mind map serializer + workflow prompt generator
  - [x] 3.6 â€” Tiered model routing strategy
  - [x] 3.7 â€” Full 10-role virtual team + prompt export modal
  - [ ] 3.8 â€” Live agent execution + Firebase real-time sync

---

_Built with âš¡ by [Antigravity](https://antigravity.google)_
